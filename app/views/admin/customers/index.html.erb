
<p id="notice"><%= notice %></p>
 <form class="border rounded bg-white form-time-table">
  <h1 class="d-flex justify-content-center">全出荷者リスト</h1>
<%= link_to "",admin_customers_path(month:@month.prev_month), class: "fas fa-angle-double-left fa-2x" %>
<strong>
<%= @month.strftime('%Y/%m') %>
</strong>
<%= link_to "",admin_customers_path(month:@month.next_month), class: "fas fa-angle-double-right fa-2x" %>

<!--<div class="vertical-scroll-table">-->
<table class="table-to-export table-bordered" style="width: -webkit-fill-available;" data-sheet-name="野菜出荷データ">
    <thead>
      <tr class="bg-light">
        <th scope="col"></th>
        <th scope="col">名前</th>
        <th scope="col">品目</th>
        <th scope="col">出荷日時</th>
        <th scope="col">出荷先</th>
        <th scope="col">コメント</th>
        <th scope="col">数量</th>
        <th scope="col">規格</th>
        <th scope="col">画像</th>

      </tr>
    </thead>

    <tbody>
      <% @items.each do |item| %>
        <tr>
          <td><input type="checkbox"></td>
          <td><%= item.customer.name %></td>
          <td><%= item.name %></td>
          <td><%= item.date.strftime('%Y/%m/%d')%></td>
          <td><%= item.send_method %></td>
          <td><%= item.comment %></td>
          <td><%= item.count %></td>
          <td><%= item.standard %></td>
          <td><%= attachment_image_tag(item, :image, :fill, 100, 100, fallback: "no-image-icon.jpg") %></td>

        </tr>
      <% end %>
    </tbody>
  </table>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.9.10/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.3/FileSaver.min.js"></script>


<hr>
<div class="d3">

  <h3>全出荷者　<%= @month.strftime('%Y年%m月') %>分　出荷量分析グラフ</h3>
  <svg width="600" height="240" style="background:#f8f8f8";>
</div>
</svg>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
  (function(){
    'use strict';

    var WIDTH = 600;
    var HEIGHT = 240;

    var padding = {
      top: 40,
      bottom: 40,
      left: 100,
      right: 40,
    };


    var scores = [
      <% @customer_data.each do |customer_data| %>
      {name: '<%= customer_data[0] %>', score: <%= customer_data[1] %> },
      <% end %>
      ];

    function update(data) {
      var bars = d3.select('svg').selectAll('rect').data(data);

      var xScale = d3.scaleLinear()
      .domain([0, d3.max(scores, function(d){
        return d.score;
      })])
      .range([0, WIDTH - padding.left - padding.right])
      .nice();

      var yScale = d3.scaleBand()
      .domain(scores.map(function(d){
        return d.name;
      }))
      .range([0, HEIGHT - padding.top - padding.bottom])
      .padding([0.1]);

      var color = d3.scaleOrdinal(d3.schemeCategory10);

      bars
        .enter()
        .append('rect')
        .merge(bars)
        .attr('x', padding.left)
        .attr('y',function(d,i){
          return yScale(d.name) + padding.top;
        })
        .attr('width', 0)
        .attr('height',yScale.bandwidth())
        .attr('fill', function(d, i){
          return color(i);
        })
        .transition()
          .duration(200)
          .delay(function(d, i){
            return i * 200;
          })
          .ease(d3.easePoly, d3.easePolyInOut)
          .attr('width', function(d){
            return xScale(d.score);
          });


      bars
        .exit()
        .remove();


      d3.select('svg')
        .append('g')
        .attr(
          'transform',
          'translate(' + [padding.left , HEIGHT - padding.bottom] +')'
          )
        .call(d3.axisBottom(xScale));

      d3.select('svg')
        .append('g')
        .attr(
          'transform',
          'translate(' + [padding.left, padding.top] +')'
          )
        .call(d3.axisLeft(yScale));
    }

    update(scores);


  })();
</script>